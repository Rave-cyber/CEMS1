@model CEMS.Models.ExpenseReport
@{
    ViewData["Title"] = "Edit Expense Report";
    Layout = "~/Views/Shared/_DriverLayout.cshtml";
    var items = Model.Items.ToList();
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<style>
    :root {
        --d-primary: #1a6bb5;
        --d-accent: #2ec4b6;
        --d-bg: #f7fbfc;
        --d-card: #ffffff;
        --d-border: #e9eef6;
        --d-text: #0f1724;
        --d-muted: #6b7280;
        --d-radius: 8px;
        --d-radius-sm: 6px;
    }

    .edit-wrapper {
        background: var(--d-bg);
        min-height: calc(100vh - 80px);
        padding: 28px 0 40px;
    }

    .edit-card {
        background: var(--d-card);
        border: 1px solid var(--d-border);
        border-radius: var(--d-radius);
        overflow: hidden;
    }

    .edit-card-head {
        padding: 16px 24px;
        border-bottom: 1px solid var(--d-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
    }

    .edit-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--d-text);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .edit-subtitle {
        color: var(--d-muted);
        font-size: .9rem;
        margin-top: 4px;
    }

    .edit-card-body {
        padding: 20px 24px 24px;
    }

    .items-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: .9rem;
    }

    .items-table thead th {
        background: #f8fafc;
        color: var(--d-muted);
        font-weight: 600;
        font-size: .78rem;
        text-transform: uppercase;
        letter-spacing: .5px;
        padding: 12px 16px;
        border-bottom: 1px solid var(--d-border);
        text-align: left;
    }

    .items-table tbody td {
        padding: 12px 16px;
        border-bottom: 1px solid #f1f5f9;
        vertical-align: middle;
    }

    .items-table tbody tr:last-child td {
        border-bottom: none;
    }

    .form-input {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid var(--d-border);
        border-radius: var(--d-radius-sm);
        font-size: .88rem;
        color: var(--d-text);
        background: #fff;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--d-primary);
        box-shadow: 0 0 0 3px rgba(26, 107, 181, .1);
    }

    .edit-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        margin-top: 20px;
    }

    .btn-primary {
        background: var(--d-primary);
        border: none;
        padding: 10px 20px;
        border-radius: var(--d-radius-sm);
        font-weight: 600;
        color: #fff;
    }

    .btn-outline {
        border: 1px solid var(--d-border);
        padding: 10px 20px;
        border-radius: var(--d-radius-sm);
        color: var(--d-text);
        background: #fff;
        text-decoration: none;
    }

    .hint-text {
        font-size: .85rem;
        color: var(--d-muted);
        margin-bottom: 16px;
    }

    @@media (max-width: 768px) {
        .edit-wrapper { padding: 20px 0 32px; }
        .items-table thead { display: none; }
        .items-table tbody td {
            display: block;
            width: 100%;
            padding: 8px 0;
            border-bottom: none;
        }
        .items-table tbody tr {
            display: block;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }
    }
</style>

<div class="edit-wrapper">
    <div class="container-fluid px-4">
        <div class="edit-card">
            <div class="edit-card-head">
                <div>
                    <div class="edit-title"><i class="bi bi-pencil-square"></i> Edit Report #@Model.Id</div>
                    <div class="edit-subtitle">Update your expense items and resubmit for review.</div>
                </div>
                <div class="edit-subtitle">Status: @Model.Status</div>
            </div>
            <div class="edit-card-body">
                <p class="hint-text">You can update the amount, category, date, description, and receipts for each item.</p>
                <form method="post" enctype="multipart/form-data" asp-action="EditReport" asp-controller="Driver" asp-route-id="@Model.Id">
                    @Html.AntiForgeryToken()
                    <div class="table-responsive">
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Description</th>
                                    <th>Receipt</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (var i = 0; i < items.Count; i++)
                                {
                                    var item = items[i];
                                    <tr>
                                        <td>
                                            <input type="hidden" name="items[@i].Id" value="@item.Id" />
                                            <input class="form-input" type="date" name="items[@i].Date" value="@item.Date.ToLocalTime().ToString("yyyy-MM-dd")" />
                                        </td>
                                        <td>
                                            <input class="form-input" type="text" name="items[@i].Category" value="@item.Category" />
                                        </td>
                                        <td>
                                            <input class="form-input" type="number" step="0.01" min="0" name="items[@i].Amount" value="@item.Amount.ToString("0.00")" />
                                        </td>
                                        <td>
                                            <input class="form-input" type="text" name="items[@i].Description" value="@item.Description" />
                                        </td>
                                        <td>
                                            <input class="form-input" type="file" name="items[@i].Receipt" />
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="edit-actions">
                        <a class="btn-outline" href="@Url.Action("MyReports", "Driver")">Cancel</a>
                        <button type="submit" class="btn-primary">Save &amp; Resubmit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
